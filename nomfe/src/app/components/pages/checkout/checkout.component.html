<div class="main-layout-box">
  <h2>Thanh toán</h2>
  <!-- Address -->
  <mat-card class="mt-4 mb-3">
    <mat-card-title class="d-flex align-items-center"
      >Địa chỉ nhận hàng<button
        *ngIf="isEditAddressForm"
        mat-icon-button
        color="primary"
        (click)="onOpenModalAddAddress()"
      >
        <mat-icon>add_circle_outline</mat-icon>
      </button></mat-card-title
    >
    <mat-card-content class="mt-4 d-flex justify-content-between">
      <!-- Edit Address Form -->
      <div class="d-block w-100" *ngIf="isEditAddressForm">
        <form [formGroup]="addressForm">
          <mat-radio-group formControlName="address">
            <mat-radio-button
              class="d-block mb-3"
              *ngFor="let item of addressList"
              value="{{ item }}"
              >{{ item }}</mat-radio-button
            >
          </mat-radio-group>
          <button
            class="mt-3"
            mat-flat-button
            color="primary"
            (click)="isEditAddressForm = false"
          >
            Xác nhận
          </button>
        </form>
      </div>

      <!-- Address Submitted Value -->
      <div *ngIf="!isEditAddressForm">
        <span>{{ addressForm.controls.address.value }}</span>
        <button mat-button color="primary" (click)="isEditAddressForm = true">
          Thay đổi
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Product list -->
  <mat-card class="mt-4 mb-6">
    <mat-card-title>Sản phẩm</mat-card-title>
    <mat-card-content>
      <table mat-table [dataSource]="dataSource" class="table">
        <!-- Name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Sản phẩm</th>

          <td mat-cell *matCellDef="let element">
            {{ element.name }}
          </td>
        </ng-container>

        <!-- Unit Column -->
        <ng-container matColumnDef="unit">
          <th mat-header-cell *matHeaderCellDef>Loại hàng</th>
          <td mat-cell *matCellDef="let element">{{ element.unit }}</td>
        </ng-container>

        <!-- Price Column -->
        <ng-container matColumnDef="price">
          <th mat-header-cell *matHeaderCellDef>Đơn giá</th>
          <td mat-cell *matCellDef="let element">
            {{ element.price | customcurrency }} đ
          </td>
        </ng-container>

        <!-- Count Column -->
        <ng-container matColumnDef="quantity">
          <th mat-header-cell *matHeaderCellDef>Số lượng</th>
          <td mat-cell *matCellDef="let element">
            {{ element.quantity }}
          </td>
        </ng-container>

        <!-- Total Price Column -->
        <ng-container matColumnDef="total_price">
          <th mat-header-cell *matHeaderCellDef>Thành tiền</th>
          <td mat-cell *matCellDef="let element">
            {{ element.total_price | customcurrency }} đ
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
      <mat-paginator
        [length]="pageLength"
        [pageSize]="5"
        [pageSizeOptions]="[5]"
        aria-label="Chọn page"
        (page)="onProductPageChange($event)"
      >
      </mat-paginator>
    </mat-card-content>
    <mat-card-footer class="d-flex align-items-center justify-content-between">
      <div></div>
      <div class="d-flex align-items-center">
        <span
          >Tổng số tiền ({{ totalProduct }} sản phẩm):
          {{ totalFinalPrice | customcurrency }} đ</span
        >
      </div>
    </mat-card-footer>
  </mat-card>

  <!-- Payment -->
  <mat-card class="mt-4 mb-3">
    <mat-card-title>Phương thức thanh toán</mat-card-title>
    <mat-card-content class="mt-4 d-flex justify-content-between">
      <div class="w-40">
        <!-- Edit Payment Method Form -->
        <form [formGroup]="paymentMethodForm" *ngIf="isEditPaymentForm">
          <div class="row mb-1">
            <mat-form-field appearance="outline">
              <mat-label>Phương thức thanh toán</mat-label>
              <mat-select
                formControlName="method"
                (valueChange)="onPaymentMethodSelectChange($event)"
              >
                <mat-option
                  *ngFor="let item of paymentMethodList"
                  [value]="item.value"
                >
                  {{ item.viewValue }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <button
            mat-flat-button
            color="primary"
            (click)="isEditPaymentForm = false"
          >
            Xác nhận
          </button>
        </form>

        <!-- Payment Method Submitted Value -->
        <div *ngIf="!isEditPaymentForm">
          <span>{{ paymentMethodShow }}</span>
          <button mat-button color="primary" (click)="isEditPaymentForm = true">
            Thay đổi
          </button>
        </div>
      </div>

      <!-- Payment Info -->
      <div class="w-40">
        <div class="row">
          <div class="col">Tổng tiền hàng</div>
          <div class="col">{{ totalFinalPrice | customcurrency }} đ</div>
        </div>
        <div class="row">
          <div class="col">Phí vận chuyển</div>
          <div class="col">32.200 đ</div>
        </div>
        <div class="row">
          <div class="col">Tổng thanh toán</div>
          <div class="col">{{ totalFinalPrice | customcurrency }} đ</div>
        </div>
      </div>
    </mat-card-content>
    <mat-card-footer class="d-flex justify-content-between">
      <div></div>
      <button mat-flat-button color="primary">Đặt hàng</button>
    </mat-card-footer>
  </mat-card>
</div>
